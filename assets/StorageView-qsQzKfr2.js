import{e as s,w as O,c as R,f as L,a as p,g as u,h as l,b as o,F as S,r as k,o as i,t as g,i as C,H as X,m as f,G as b,l as j,I as q}from"./index-SP2z9WD4.js";import{u as B}from"./boxes-ZcsXpuKf.js";import{u as M}from"./history-biYwz7md.js";import{_ as h,a as z}from"./VButton-3enoblqL.js";import{_ as T}from"./VCheck-751MFHOR.js";const A={class:"storage"},J=o("h1",null,"Склад",-1),K={class:"height__body"},P={class:"storage__category"},Q={class:"storage__item"},W={class:"storage__item--name"},Y={class:"storage__item--count"},Z=o("h2",null,"Изменить позицию",-1),ne={__name:"StorageView",setup(ee){const c=s(!1),y=s(""),_=s(""),v=s(""),d=s(!1),m=s("2000-01-01"),V=s(!1),w=s(!1);async function $(e){let{data:t,error:r}=await q.from("BOXES").select("*").eq("id",e);await M().postHistoryChange(e,{name:t[0].name,count:0,dateLife:t[0].dateLife}),await B().deleteBox(e)}async function G(){V.value=!0,w.value=!1;try{let e={name:_.value,count:v.value,dateLife:m.value};await M().postHistoryChange(y.value,e),await B().editBox(y.value,e),c.value=!1}catch{w.value=!0}V.value=!1}O(d,e=>{e||(m.value="2000-01-01")});function E(e){c.value=!0,y.value=e.id,_.value=e.name,v.value=e.count,d.value=e.dateLife!=="2000-01-01",m.value=e.dateLife}function H(e){if(e!=="2000-01-01"&&+new Date(e)-Date.now()<=1e3*60*60*24*60)return!0}function N(e){return e!=="2000-01-01"?e.split("-").reverse().join("-"):"∞"}const x=R(()=>B().boxes.reduce((e,t)=>{const r=t.category.name;return e[r]=e[r]??[],e[r].push(t),e},{}));return(e,t)=>{const r=L("router-link"),D=L("GSwiper"),U=L("GModal");return i(),p("div",A,[u(r,{to:{name:"Home"}},{default:l(()=>[J]),_:1}),o("div",K,[(i(!0),p(S,null,k(x.value,(a,F)=>(i(),p("div",{class:"storage_groupe",key:a.id},[o("div",P,g(F),1),(i(!0),p(S,null,k(a,n=>(i(),C(D,{key:n.id,onRight:I=>$(n.id),onLeft:I=>E(n)},{default:l(()=>[o("div",Q,[o("div",W,g(n.name),1),o("div",Y,g(n.count)+" ед.",1),o("div",{class:X(["storage__item--dateLife",{expired:H(n.dateLife)}])},g(N(n.dateLife)),3)])]),_:2},1032,["onRight","onLeft"]))),128))]))),128))]),u(U,{open:c.value,onClose:t[5]||(t[5]=a=>c.value=!1)},{default:l(()=>[o("form",{onSubmit:t[4]||(t[4]=j(a=>G(),["prevent"]))},[Z,u(h,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=a=>_.value=a),modelModifiers:{trim:!0}},{default:l(()=>[f("Название")]),_:1},8,["modelValue"]),u(h,{modelValue:v.value,"onUpdate:modelValue":t[1]||(t[1]=a=>v.value=a),modelModifiers:{trim:!0,number:!0},type:"number"},{default:l(()=>[f("Количество")]),_:1},8,["modelValue"]),u(T,{modelValue:d.value,"onUpdate:modelValue":t[2]||(t[2]=a=>d.value=a),modelModifiers:{trim:!0}},{default:l(()=>[f("Имеет срок годности")]),_:1},8,["modelValue"]),d.value?(i(),C(h,{key:0,modelValue:m.value,"onUpdate:modelValue":t[3]||(t[3]=a=>m.value=a),type:"date"},{default:l(()=>[f(" Срок годности ")]),_:1},8,["modelValue"])):b("",!0),u(z,{disabled:V.value,error:w.value},{default:l(()=>[f("Изменить")]),_:1},8,["disabled","error"])],32)]),_:1},8,["open"])])}}};export{ne as default};
